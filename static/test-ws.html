<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
        .container { max-width: 800px; margin: 0 auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .connected { background: #0d4f0d; color: #4caf50; }
        .disconnected { background: #4f0d0d; color: #f44336; }
        .messages { height: 400px; overflow-y: auto; background: #2d2d30; padding: 10px; border-radius: 4px; }
        .message { margin: 4px 0; padding: 4px; background: #3c3c3c; border-radius: 2px; }
        button { padding: 10px 20px; margin: 5px; background: #007acc; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #005a9e; }
        button:disabled { background: #666; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="container">
        <h1>WebSocket è¿æ¥æµ‹è¯•</h1>
        
        <div id="status" class="status disconnected">âŒ æœªè¿æ¥</div>
        
        <div>
            <button id="connect" onclick="connectWS()">è¿æ¥</button>
            <button id="disconnect" onclick="disconnectWS()" disabled>æ–­å¼€</button>
            <button onclick="clearMessages()">æ¸…ç©ºæ¶ˆæ¯</button>
            <button onclick="sendTestMessage()">å‘é€æµ‹è¯•æ¶ˆæ¯</button>
        </div>
        
        <h3>æ¶ˆæ¯æ—¥å¿—:</h3>
        <div id="messages" class="messages"></div>
    </div>

    <script>
        let ws = null;
        const statusEl = document.getElementById('status');
        const messagesEl = document.getElementById('messages');
        const connectBtn = document.getElementById('connect');
        const disconnectBtn = document.getElementById('disconnect');

        function addMessage(msg) {
            const div = document.createElement('div');
            div.className = 'message';
            div.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            messagesEl.appendChild(div);
            messagesEl.scrollTop = messagesEl.scrollHeight;
        }

        function updateStatus(connected) {
            if (connected) {
                statusEl.textContent = 'âœ… å·²è¿æ¥';
                statusEl.className = 'status connected';
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
            } else {
                statusEl.textContent = 'âŒ æœªè¿æ¥';
                statusEl.className = 'status disconnected';
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
            }
        }

        function connectWS() {
            try {
                addMessage('å°è¯•è¿æ¥ ws://localhost:8081...');
                ws = new WebSocket('ws://localhost:8081');
                
                ws.onopen = function() {
                    addMessage('âœ… WebSocket è¿æ¥æˆåŠŸ!');
                    updateStatus(true);
                };
                
                ws.onmessage = function(event) {
                    addMessage(`ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯: ${event.data}`);
                };
                
                ws.onclose = function(event) {
                    addMessage(`âŒ è¿æ¥å…³é—­: Code=${event.code}, Reason=${event.reason}`);
                    updateStatus(false);
                };
                
                ws.onerror = function(error) {
                    addMessage(`ğŸš¨ WebSocket é”™è¯¯: ${error}`);
                    updateStatus(false);
                };
                
            } catch (error) {
                addMessage(`âŒ è¿æ¥å¤±è´¥: ${error}`);
                updateStatus(false);
            }
        }

        function disconnectWS() {
            if (ws) {
                ws.close();
                ws = null;
            }
        }

        function clearMessages() {
            messagesEl.innerHTML = '';
        }

        function sendTestMessage() {
            if (ws && ws.readyState === WebSocket.OPEN) {
                const msg = JSON.stringify({
                    type: 'ping',
                    timestamp: new Date().toISOString(),
                    message: 'Test from WebSocket test page'
                });
                ws.send(msg);
                addMessage(`ğŸ“¤ å‘é€æ¶ˆæ¯: ${msg}`);
            } else {
                addMessage('âŒ WebSocket æœªè¿æ¥ï¼Œæ— æ³•å‘é€æ¶ˆæ¯');
            }
        }

        // è‡ªåŠ¨è¿æ¥
        connectWS();
    </script>
</body>
</html> 